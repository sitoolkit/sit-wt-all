== スクリーンショット比較機能
:imagesdir: img/スクリーンショット比較機能


スクリーンショット比較機能は、テスト実行後に生成したエビデンスの全スクリーンショットを、あらかじめ基準として用意したエビデンスと比較する機能です。
一度基準のエビデンスを確定すれば、スクリーンショットの検証を自動で実施することができます。

なお、以降は基準となるエビデンスのことを**基準エビデンス**と表記します。



=== スクリーンショット比較機能の実行

基準エビデンスを確定し、スクリーンショット比較機能を実行する一連の手順です。ここでは例として、サンプルWebサイトを使います。

. image:ic_play_circle_outline_black_18dp_1x.png[]ボタンをクリックし、サンプルWebサイトを起動します。
+
image::run-sample.png[,500]


. SampleTestScriptを選択した状態でimage:ic_play_arrow_black_18dp_1x.png[]ボタンをクリックし、テストを実行します。
+
image::running-test.png[,700]


. 2で作成されたエビデンスディレクトリを選択してimage:ic_done_black_18dp_1x.png[]ボタンをクリックし、基準エビデンスとして確定します。
+
image::confirm-base-evidence.png[,500]


. スクリーンショット比較機能を有効にするimage:ic_photo_black_18dp_1x.png[]トグルボタンをONにし、2と同様のケースのテストを実行します。テスト終了後は、生成したエビデンスの全スクリーンショットと基準エビデンスとの比較が、自動で実行されます。
+
image::compare-screenshot-log.png[,400]
+
また、不一致となるスクリーンショットがあった場合は、**比較エビデンス**が生成・表示されます。
比較エビデンスとは、2つのエビデンスのスクリーンショットを横に並べて目視で確認しやすくしたエビデンスです。
+
image::diff-ng-evidence.png[,700]
+
比較エビデンスでは、不一致となったスクリーンショットの背景が赤色になって表示されます。
エビデンス右側のスクリーンショットで、色が暗くなっている部分が一致する箇所、暗くなっていない部分が不一致の箇所です。
この例では、スクリーンショット右上のタイムスタンプ表示部分で差異があることがわかります。



=== 基準エビデンスの作成方法

基準エビデンス作成時に使用する以下の機能について説明します。

* スクリーンショットの一部を比較対象から除外する
* 2つのエビデンスを並べて目視で確認する


==== スクリーンショットの一部を比較対象から除外する
スクリーンショットにマスクをかけ、一部を比較対象から除外できるようにします。

. テスト実行後、除外部分を指定したいスクリーンショットのあるエビデンスを開きます。
SIT-WT上から開く場合は、該当のファイルを右クリック＞「開く」をクリックします。
+
image::open-evidence.png[]


. ブラウザでエビデンスのスクリーンショット上に付箋を貼って保存します。
+
image::set-fusen.png[,700]


. SIT-WT上で対象のエビデンスディレクトリを選択してimage:ic_picture_in_picture_black_18dp_1x.png[]ボタンをクリックすると、付箋を貼った形にマスクがかかったスクリーンショットが確認できるエビデンスが生成・表示されます。
+
image::masked-evidence.png[,700]


. 続けてimage:ic_done_black_18dp_1x.png[]ボタンをクリックし、基準エビデンスとして保存します。


==== 2つのエビデンスを並べて目視で確認する

SIT-WT上のimage:ic_compare_arrows_black_18dp_1x.png[]ボタンをクリックすると、2つのエビデンスを並べて確認できる、比較エビデンスが生成・表示されます。

image::diff-evidence-sample.png[,700]

image:ic_compare_arrows_black_18dp_1x.png[]ボタンクリック時にツリー内のディレクトリを選択しておくことで、比較対象とするエビデンスを指定できます。

[%autowidth]
|===
|選択ディレクトリ|比較対象のエビデンス

|エビデンスディレクトリ2つ※
|選択した2つのディレクトリのエビデンス

|エビデンスディレクトリ1つ
|選択したディレクトリのエビデンスと、同じブラウザの基準エビデンス

|選択なし
|最後に実行したテストのエビデンスと、同じブラウザの基準エビデンス
|===

※ WindowsではCtrlキー、macOSではcommandキーを押しながら項目をクリックすることで、項目の複数選択が可能です。 +
また、これらのキーを押しながら選択済みの項目をクリックすると、選択が解除されます。